<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mundo do Aprendizado</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body class="gradient-background p-6">
    <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-purple-800 flex items-center justify-center gap-2">
            <i class="fas fa-stars text-yellow-500"></i>
            Mundo do Aprendizado
            <i class="fas fa-stars text-yellow-500"></i>
        </h1>
    </header>

    <div id="mainSection" class="max-w-4xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card button-gradient-blue text-white">
                <div class="flex flex-col items-center gap-4">
                    <i class="fas fa-question-circle text-4xl"></i>
                    <h2 class="text-2xl font-bold">Tire suas Dúvidas</h2>
                    <p class="text-center">Escolha uma matéria e faça suas perguntas!</p>
                    <button onclick="showSection('subjects')"
                        class="mt-4 bg-white text-blue-600 px-6 py-2 rounded-full font-bold hover:bg-blue-50">
                        Começar
                    </button>
                </div>
            </div>

            <div class="card button-gradient-purple text-white">
                <div class="flex flex-col items-center gap-4">
                    <i class="fas fa-book text-4xl"></i>
                    <h2 class="text-2xl font-bold">Crie Histórias</h2>
                    <p class="text-center">Invente histórias mágicas e divertidas!</p>
                    <button onclick="showSection('story')"
                        class="mt-4 bg-white text-purple-600 px-6 py-2 rounded-full font-bold hover:bg-purple-50">
                        Começar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="subjectsSection" class="max-w-4xl mx-auto hidden">
        <button onclick="showSection('main')"
            class="mb-6 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600" id="btn-voltar">
            Voltar
        </button>

        <div id="subjectsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="subject-card math" onclick="selectSubject('Matemática', 'Prof. Carlos')">
                <img src="./img/prof2.png" alt="Professor de Matemática" class="w-24 h-24 rounded-full mx-auto mb-2">
                <h3 class="text-xl font-bold">Prof. Carlos</h3>
                <p>Matemática</p>
            </div>
            <div class="subject-card history" onclick="selectSubject('História', 'Profª. Ana')">
                <img src="./img/prof1.png" alt="Professora de História" class="w-24 h-24 rounded-full mx-auto mb-2">
                <h3 class="text-xl font-bold">Profª. Ana</h3>
                <p>História</p>
            </div>
            <div class="subject-card science" onclick="selectSubject('Ciências', 'Prof. Pedro')">
                <img src="./img/prof4.png" alt="Professor de Ciências" class="w-24 h-24 rounded-full mx-auto mb-2">
                <h3 class="text-xl font-bold">Prof. Pedro</h3>
                <p>Ciências</p>
            </div>
            <div class="subject-card portuguese" onclick="selectSubject('Português', 'Profª. Maria')">
                <img src="./img/prof3.png" alt="Professora de Português" class="w-24 h-24 rounded-full mx-auto mb-2">
                <h3 class="text-xl font-bold">Profª. Maria</h3>
                <p>Português</p>
            </div>
            <div class="subject-card geography" onclick="selectSubject('Geografia', 'Prof. João')">
                <img src="./img/prof6.png" alt="Professor de Geografia" class="w-24 h-24 rounded-full mx-auto mb-2">
                <h3 class="text-xl font-bold">Prof. João</h3>
                <p>Geografia</p>
            </div>
            <div class="subject-card physical-education" onclick="selectSubject('Educação Física', 'Profª. Clara')">
                <img src="./img/prof5.png" alt="Professora de Educação Física" class="w-24 h-24 rounded-full mx-auto mb-2">
                <h3 class="text-xl font-bold">Profª. Clara</h3>
                <p>Educação Física</p>
            </div>
            <div class="subject-card english" onclick="selectSubject('Inglês', 'Prof. Lucas')">
                <img src="./img/prof7.png" alt="Professor de Inglês" class="w-24 h-24 rounded-full mx-auto mb-2">
                <h3 class="text-xl font-bold">Prof. Lucas</h3>
                <p>Inglês</p>
            </div>
            <div class="subject-card art" onclick="selectSubject('Arte', 'Profª. Sofia')">
                <img src="./img/prof8.png" alt="Professora de Arte" class="w-24 h-24 rounded-full mx-auto mb-2">
                <h3 class="text-xl font-bold">Profª. Sofia</h3>
                <p>Arte</p>
            </div>
        </div>

        <div id="questionArea" class="hidden card mt-6">
            <h2 id="questionTitle" class="text-2xl font-bold text-purple-600 mb-4"></h2>
            <textarea id="questionInput" placeholder="Digite sua pergunta aqui..."
                class="w-full p-4 border-2 border-purple-300 rounded-lg mb-4 h-32"></textarea>
            <div class="flex justify-between">
                <button onclick="backToSubjects()"
                    class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                    Voltar
                </button>
                <button onclick="submitQuestion()" id="submitQuestionBtn"
                    class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                    Enviar Pergunta
                </button>
            </div>
            <div id="questionResponse" class="response-area hidden"></div>
        </div>
    </div>

    <div id="storySection" class="max-w-4xl mx-auto hidden">
        <button onclick="showSection('main')"
            class="mb-6 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
            Voltar
        </button>

        <div class="card">
            <h2 class="text-2xl font-bold text-purple-600 mb-6">
                <i class="fas fa-book-reader mr-2"></i>
                Crie sua História
            </h2>

            <div class="space-y-4">
                <div>
                    <label class="block text-purple-600 font-bold mb-2">
                        Quais são os nomes dos personagens?
                    </label>
                    <input type="text" id="characterNames" class="w-full p-3 border-2 border-purple-300 rounded-lg"
                        placeholder="Ex: João, Maria, Pedro">
                </div>

                <div>
                    <label class="block text-purple-600 font-bold mb-2">
                        Onde a história acontece?
                    </label>
                    <input type="text" id="storySetting" class="w-full p-3 border-2 border-purple-300 rounded-lg"
                        placeholder="Ex: floresta encantada, escola mágica">
                </div>

                <div>
                    <label class="block text-purple-600 font-bold mb-2">
                        Sobre o que é sua história?
                    </label>
                    <input type="text" id="storyTheme" class="w-full p-3 border-2 border-purple-300 rounded-lg"
                        placeholder="Ex: uma aventura espacial, um mistério na escola">
                </div>

                <div>
                    <label class="block text-purple-600 font-bold mb-2">
                        Qual é o gênero da história?
                    </label>
                    <select id="storyGenre" class="w-full p-3 border-2 border-purple-300 rounded-lg">
                        <option value="">Selecione o gênero</option>
                        <option value="Aventura">Aventura</option>
                        <option value="Fantasia">Fantasia</option>
                        <option value="Mistério">Mistério</option>
                        <option value="Fábula">Fábula</option>
                        <option value="Conto de Fadas">Conto de Fadas</option>
                    </select>
                </div>

                <div>
                    <label class="block text-purple-600 font-bold mb-2">
                        O que os personagens gostam de fazer?
                    </label>
                    <input type="text" id="charactersHobbies" class="w-full p-3 border-2 border-purple-300 rounded-lg"
                        placeholder="Ex: jogar futebol, explorar florestas, pintar">
                </div>

                <div>
                    <label class="block text-purple-600 font-bold mb-2">
                        Há algum objeto mágico na história?
                    </label>
                    <input type="text" id="magicObject" class="w-full p-3 border-2 border-purple-300 rounded-lg"
                        placeholder="Ex: uma varinha mágica, um mapa do tesouro">
                </div>

                <div>
                    <label class="block text-purple-600 font-bold mb-2">
                        Qual é o desafio ou problema que os personagens enfrentam?
                    </label>
                    <input type="text" id="storyChallenge" class="w-full p-3 border-2 border-purple-300 rounded-lg"
                        placeholder="Ex: salvar a floresta, encontrar um amigo perdido">
                </div>


                <button onclick="generateStory()" id="generateStoryBtn"
                    class="w-full px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 font-bold mt-4">
                    Criar História Mágica
                </button>

                <div id="storyResponse" class="response-area hidden"></div>
                <div id="storyImages" class="mt-4 hidden">
                    <h3 class="text-lg font-bold text-purple-600 mb-2">Imagens relacionadas à história:</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="imageLinks">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GROQ_API_KEY = "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";
        let currentSubject = '';
        let currentTeacher = '';

        const subjectTeacherMap = {
            'Matemática': 'Prof. Carlos',
            'História': 'Profª. Ana',
            'Ciências': 'Prof. Pedro',
            'Português': 'Profª. Maria',
            'Geografia': 'Prof. João',
            'Educação Física': 'Profª. Clara',
            'Inglês': 'Prof. Lucas',
            'Arte': 'Profª. Sofia'
        };

        function showSection(sectionName) {
            document.getElementById('mainSection').classList.add('hidden');
            document.getElementById('subjectsSection').classList.add('hidden');
            document.getElementById('storySection').classList.add('hidden');

            document.getElementById(`${sectionName}Section`).classList.remove('hidden');

            document.getElementById('questionResponse').classList.add('hidden');
            document.getElementById('storyResponse').classList.add('hidden');
            document.getElementById('storyImages').classList.add('hidden');
        }

        function selectSubject(subject, teacher) {
            currentSubject = subject;
            currentTeacher = teacher;
            document.getElementById('subjectsList').classList.add('hidden');
            document.getElementById('questionArea').classList.remove('hidden');
            document.getElementById('btn-voltar').classList.add('hidden');
            document.getElementById('questionTitle').textContent = `Fale com ${teacher} sobre ${subject}`;
        }

        function backToSubjects() {
            document.getElementById('btn-voltar').classList.remove('hidden');
            document.getElementById('subjectsList').classList.remove('hidden');
            document.getElementById('questionArea').classList.add('hidden');
            document.getElementById('questionResponse').classList.add('hidden');
        }

        async function callGroqAPI(prompt, isStory = false) {
            const button = isStory ? 'generateStoryBtn' : 'submitQuestionBtn';
            const responseArea = isStory ? 'storyResponse' : 'questionResponse';

            document.getElementById(button).innerHTML = '<i class="fas fa-spinner loading"></i> Pensando...';
            document.getElementById(button).disabled = true;

            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${GROQ_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "mixtral-8x7b-32768",
                        messages: [{
                            role: "system",
                            content: isStory
                                ? "Você é um contador de histórias infantis criativo e amigável. Crie histórias apropriadas para crianças, divertidas e educativas. Certifique-se de que o conteúdo é adequado para jovens, evitando tópicos ou linguagens inapropriadas. No final da história, inclua a moral ou lição aprendida."
                                : `Você é o ${currentTeacher}, professor(a) de ${currentSubject}. Responda apenas a perguntas relacionadas a ${currentSubject}. Se a pergunta não for sobre ${currentSubject}, responda educadamente que não pode ajudar e sugira procurar o professor responsável pela matéria. Os professores e suas matérias são: ${getTeachersList()}.`
                        }, {
                            role: "user",
                            content: prompt
                        }],
                        temperature: isStory ? 0.8 : 0.5,
                        max_tokens: isStory ? 1024 : 512,
                    })
                });

                const data = await response.json();
                const content = data.choices[0].message.content;

                const responseElement = document.getElementById(responseArea);
                responseElement.textContent = content;
                responseElement.classList.remove('hidden');

                if (isStory) {
                    generateImageLinks(content);
                }

            } catch (error) {
                console.error('Erro ao chamar a API:', error);
                const responseElement = document.getElementById(responseArea);
                responseElement.textContent = 'Desculpe, tive um problema ao gerar a resposta. Pode tentar novamente?';
                responseElement.classList.remove('hidden');
            } finally {
                document.getElementById(button).innerHTML = isStory ? 'Criar História Mágica' : 'Enviar Pergunta';
                document.getElementById(button).disabled = false;
            }
        }

        function getTeachersList() {
            return Object.entries(subjectTeacherMap)
                .map(([subject, teacher]) => `${teacher} (${subject})`)
                .join(', ');
        }

        async function submitQuestion() {
            const question = document.getElementById('questionInput').value.trim();
            if (!question) return;

            const prompt = `${question}`;
            await callGroqAPI(prompt);
        }

        async function generateStory() {
            const names = document.getElementById('characterNames').value;
            const setting = document.getElementById('storySetting').value;
            const theme = document.getElementById('storyTheme').value;
            const genre = document.getElementById('storyGenre').value;
            const hobbies = document.getElementById('charactersHobbies').value;
            const magicObject = document.getElementById('magicObject').value;
            const challenge = document.getElementById('storyChallenge').value;

            if (!names || !setting || !theme || !genre || !hobbies || !magicObject || !challenge) {
                alert('Por favor, preencha todos os campos!');
                return;
            }

            const prompt = `Por favor, crie uma história infantil com os seguintes elementos:
            - Nomes dos personagens: ${names}
            - Cenário: ${setting}
            - Tema: ${theme}
            - Gênero da história: ${genre}
            - O que os personagens gostam de fazer: ${hobbies}
            - Objeto mágico: ${magicObject}
            - Desafio ou problema: ${challenge}

            A história deve ser educativa, divertida e apropriada para crianças. No final, inclua a moral ou lição aprendida.`;

            await callGroqAPI(prompt, true);
        }

        function generateImageLinks(storyContent) {
            const words = storyContent.split(/\s+/);
            const keywordCounts = {};

            words.forEach(word => {
                word = word.toLowerCase().replace(/[.,!?:;()"]/g, '');
                if (word.length > 4) {
                    keywordCounts[word] = (keywordCounts[word] || 0) + 1;
                }
            });

            const sortedKeywords = Object.keys(keywordCounts).sort((a, b) => keywordCounts[b] - keywordCounts[a]);
            const topKeywords = sortedKeywords.slice(0, 3);

            const imageLinksDiv = document.getElementById('imageLinks');
            imageLinksDiv.innerHTML = ''; 

            topKeywords.forEach(keyword => {
                const url = `https://www.google.com/search?q=${encodeURIComponent(keyword)}&tbm=isch`;
                const linkElement = document.createElement('a');
                linkElement.href = url;
                linkElement.target = '_blank';
                linkElement.classList.add('block', 'bg-white', 'p-4', 'rounded-lg', 'text-center', 'shadow');
                linkElement.innerHTML = `<p class="text-purple-600 font-bold">${keyword.charAt(0).toUpperCase() + keyword.slice(1)}</p>`;
                imageLinksDiv.appendChild(linkElement);
            });

            document.getElementById('storyImages').classList.remove('hidden');
        }
    </script>

    <style>
        .gradient-background {
            background: linear-gradient(180deg, #c4b5fd 0%, #e9d5ff 100%);
            min-height: 100vh;
        }

        .card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .button-gradient-blue {
            background: linear-gradient(45deg, #60a5fa, #3b82f6);
            transition: all 0.3s;
        }

        .button-gradient-purple {
            background: linear-gradient(45deg, #a78bfa, #8b5cf6);
            transition: all 0.3s;
        }

        .button-gradient-blue:hover,
        .button-gradient-purple:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .subject-card {
            padding: 1rem;
            border-radius: 0.75rem;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .subject-card:hover {
            transform: translateY(-5px);
        }

        .subject-card img {
            border: 2px solid white;
        }

        .math {
            background-color: #ec4899;
        }

        .history {
            background-color: #8b5cf6;
        }

        .science {
            background-color: #10b981;
        }

        .portuguese {
            background-color: #3b82f6;
        }

        .geography {
            background-color: #f59e0b;
        }

        .physical-education {
            background-color: #ef4444;
        }

        .english {
            background-color: #6366f1;
        }

        .art {
            background-color: #f472b6;
        }

        .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .response-area {
            background-color: #f3e8ff;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .hidden {
            display: none;
        }
    </style>
</body>

</html>
